# This is an example .goreleaser.yml file with some sane defaults.
# Make sure to check the documentation at http://goreleaser.com
before:
  hooks:
    # You may remove this if you don't use go modules.
    - go mod tidy

# .goreleaser.yml
builds:
  - id: default
    main: ./cmd/kcl/main.go
    binary: kcl
    goos:
      - darwin
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    env:
      - CGO_ENABLED=0
    ldflags:
      - "-X kcl-lang.io/cli/pkg/version.version={{.Version}}"

archives:
  - id: default
    builds:
      - default
    name_template: "kcl-v{{ .Version }}-{{ .Os }}-{{ .Arch }}"
    format_overrides:
      - goos: windows
        format: zip

nfpms:
  -
    id: kcl
    package_name: kcl
    file_name_template: "kcl-v{{ .Version }}-{{ .Os }}-{{ .Arch }}"
    builds:
      - kcl
    vendor: The KCL Programming Language
    homepage: kcl-lang.io
    maintainer: The KCL Programming Language
    description: A CLI tool for KCL
    license: AGPL-3.0
    release: "1"
    formats:
      - deb
      - rpm
    dependencies:
      - git
      - zsh
    # Path that the binaries should be installed.
    bindir: /usr/bin

brews:
  - tap:
      owner: kcl-lang
      name: homebrew-tap
    name: kcl
    url_template: "https://github.com/kcl-lang/cli/releases/download/{{ .Tag }}/kcl-v{{ .Version }}-{{ .Os }}-{{ .Arch }}.tar.gz"
    download_strategy: CurlDownloadStrategy
    # Git author used to commit to the repository.
    # Defaults are shown.
    commit_author:
      name: GoReleaser Bot
      email: goreleaser@carlosbecker.com
    folder: HomebrewFormula
    homepage: "https://github.com/kcl-lang/kcl"
    description: "KCL Command Line Interface"
    license: "Apache License"
    skip_upload: false
    test: |
      system "#{bin}/kcl version"

scoop:
  name: kcl
  url_template: "https://github.com/kcl-lang/cli/releases/download/{{ .Tag }}/kcl-v{{ .Version }}-{{ .Os }}-{{ .Arch }}.zip"
  bucket:
    owner: kcl-lang
    name: scoop-bucket
    branch: main
    token: "{{ .Env.GITHUB_TOKEN }}"
  folder: Scoops
  commit_author:
    name: goreleaserbot
    email: bot@goreleaser.com
  commit_msg_template: "Scoop update for kcl version {{ .Tag }}"
  homepage: "http://github.com/kcl-lang/kcl"
  description: "KCL Command Line Interface"
  license: Apache License 2.0
